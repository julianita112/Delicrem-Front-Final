import{useRef as T,useState as b}from"react";import{disposables as p}from'../utils/disposables.js';import{useDisposables as m}from'./use-disposables.js';import{useFlags as E}from'./use-flags.js';import{useIsoMorphicEffect as L}from'./use-iso-morphic-effect.js';var g=(r=>(r[r.None=0]="None",r[r.Closed=1]="Closed",r[r.Enter=2]="Enter",r[r.Leave=4]="Leave",r))(g||{});function H(e){let n={};for(let t in e)e[t]===!0&&(n[`data-${t}`]="");return n}function j(e,n,t,i){let[r,a]=b(t),{hasFlag:f,addFlag:o,removeFlag:s}=E(e&&r?3:0),u=T(!1),l=T(!1),S=m();return L(()=>{var d;if(e){if(t&&a(!0),!n){t&&o(3);return}return(d=i==null?void 0:i.start)==null||d.call(i,t),C(n,{inFlight:u,prepare(){l.current?l.current=!1:l.current=u.current,u.current=!0,!l.current&&(t?(o(3),s(4)):(o(4),s(2)))},run(){l.current?t?(s(3),o(4)):(s(4),o(3)):t?s(1):o(1)},done(){var c;l.current&&typeof n.getAnimations=="function"&&n.getAnimations().length>0||(u.current=!1,s(7),t||a(!1),(c=i==null?void 0:i.end)==null||c.call(i,t))}})}},[e,t,n,S]),e?[r,{closed:f(1),enter:f(2),leave:f(4),transition:f(2)||f(4)}]:[t,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}function C(e,{prepare:n,run:t,done:i,inFlight:r}){let a=p();return M(e,{prepare:n,inFlight:r}),a.nextFrame(()=>{t(),a.requestAnimationFrame(()=>{a.add(y(e,i))})}),a.dispose}function y(e,n){let t=p();if(!e)return t.dispose;let i=!1;t.add(()=>{i=!0});let r=e.getAnimations().filter(a=>a instanceof CSSTransition);return r.length===0?(n(),t.dispose):(Promise.allSettled(r.map(a=>a.finished)).then(()=>{i||n()}),t.dispose)}function M(e,{inFlight:n,prepare:t}){if(n!=null&&n.current){t();return}let i=e.style.transition;e.style.transition="none",t(),e.offsetHeight,e.style.transition=i}export{H as transitionDataAttributes,j as useTransition};
